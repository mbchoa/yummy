import { type NextPage } from "next";
import { signIn, signOut } from "next-auth/react";
import Head from "next/head";
import { useRouter } from "next/router";
import { LoggingIn } from "../components/loggingIn";
import { useRequireAuth } from "../hooks/useRequireAuth";

const Home: NextPage = () => {
  const router = useRouter();
  const { session: sessionData, loading } = useRequireAuth();

  if (
    loading === true ||
    sessionData == null ||
    sessionData.user == null ||
    router.isReady === false
  ) {
    return <LoggingIn />;
  }

  if (
    loading === false &&
    sessionData !== null &&
    sessionData.user !== null &&
    router.isReady === true
  ) {
    router.push("/dashboard");
  }

  return (
    <>
      <Head>
        <title>yummy</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-[#2e026d] to-[#15162c]">
        <div className="container flex flex-col items-center justify-center gap-12 px-4 py-16 ">
          <h1 className="text-5xl font-extrabold tracking-tight text-white sm:text-[5rem]">
            yu<span className="text-[hsl(280,100%,70%)]">mm</span>y
          </h1>
          <div className="flex flex-col items-center gap-2">
            <div className="flex flex-col items-center justify-center gap-4">
              <p className="text-center text-2xl text-white">
                {sessionData && (
                  <span>Logged in as {sessionData.user.name}</span>
                )}
              </p>
              <button
                className="rounded-full bg-white/10 px-10 py-3 font-semibold text-white no-underline transition hover:bg-white/20"
                onClick={
                  sessionData
                    ? () => signOut()
                    : () =>
                        signIn("auth0", {
                          callbackUrl: "/dashboard",
                        })
                }
              >
                Sign in
              </button>
            </div>
          </div>
        </div>
      </main>
    </>
  );
};

export default Home;
